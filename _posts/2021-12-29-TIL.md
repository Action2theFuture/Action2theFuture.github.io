---
layout: post
title: "pt-online-schema-change"
date: 2021-12-29
categories: TIL pt-online-schema-change
---

- 명령어 예시
  [참고 사이트](https://playdev.tistory.com/1)

# 컬럼 추가

pt-online-schema-change --alter "ADD COLUMN address VARCHAR(50) DEFAULT NULL COMMENT '주소' AFTER name" D=데이터베이스명,t=테이블명 --host=호스트 --port=포트 --user=DB계정 --password="DB비밀번호" --charset=UTF8 --chunk-size=1000 --max-load="Threads_running=100" --alter-foreign-keys-method=auto --chunk-index=PRIMARY --sleep=0.003 --no-drop-old-table --execute

# 컬럼 변경 (ex. contents VARCHAR(50) 을 LONGTEXT 로)

pt-online-schema-change --alter "MODIFY contents LONGTEXT" D=데이터베이스명,t=테이블명 --host=호스트 --port=포트 --user=DB계정 --password="DB비밀번호" --charset=UTF8 --chunk-size=1000 --max-load="Threads_running=100" --alter-foreign-keys-method=auto --chunk-index=PRIMARY --sleep=0.003 --no-drop-old-table --execute

# 컬럼 제거

pt-online-schema-change --alter "DROP COLUMN 컬럼1" D=데이터베이스명,t=테이블명 --host=호스트 --port=포트 --user=DB계정 --password="DB비밀번호" --charset=UTF8 --chunk-size=1000 --max-load="Threads_running=100" --alter-foreign-keys-method=auto --chunk-index=PRIMARY --sleep=0.003 --no-drop-old-table --execute

# Index 추가

pt-online-schema-change --alter "ADD INDEX INDEX_1 (컬럼1, 컬럼2, 컬럼3)" D=데이터베이스명,t=테이블명 --host=호스트 --port=포트 --user=DB계정 --password="DB비밀번호" --charset=UTF8 --chunk-size=1000 --max-load="Threads_running=100" --alter-foreign-keys-method=auto --chunk-index=PRIMARY --sleep=0.003 --no-drop-old-table --execute

# Unique Key 추가

pt-online-schema-change --alter "ADD CONSTRAINT UNIQUE_1 UNIQUE(컬럼2, 컬럼2, 컬럼3)" D=데이터베이스명,t=테이블명 --host=호스트 --port=포트 --user=DB계정 --password="DB비밀번호" --charset=UTF8 --chunk-size=1000 --max-load="Threads_running=100" --alter-foreign-keys-method=auto --chunk-index=PRIMARY --sleep=0.003 --no-drop-old-table --execute

# Index, Unique Key 제거

pt-online-schema-change --alter "DROP INDEX 인덱스명 또는 유니크키명" D=데이터베이스명,t=테이블명 --host=호스트 --port=포트 --user=DB계정 --password="DB비밀번호" --charset=UTF8 --chunk-size=1000 --max-load="Threads_running=100" --alter-foreign-keys-method=auto --chunk-index=PRIMARY --sleep=0.003 --no-drop-old-table --execute

※ --alter-foreign-keys-method=auto
: Index 를 추가 또는 변경하려는 DB에 FK 가 걸려 있을 경우 에러발생 => 툴에 위임 (auto 권장)
