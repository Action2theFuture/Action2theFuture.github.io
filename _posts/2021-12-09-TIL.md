---
layout: post
title: "Prisma ê¸°ì´ˆ ğŸ’¬"
date: 2021-12-09
categories: TIL Prisma
---

![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/prisma.png)

# Prisma

ì§€ì›í•˜ëŠ” DataBase : MySQL, ProgreSQL, SQLite

### Prisma êµ¬ì„±ìš”ì†Œ

- **Prisma Client**: Auto-generated and type-safe query builder for Node.js & TypeScript
- **Prisma Migrate**: Migration system
- **Prisma Studio**: GUI to view and edit data in your database

### Prisma Start

- Prisma ì„¤ì¹˜í•˜ê¸°

```bash
npm i @prisma/client
```

- Prisma ë””ë ‰í† ë¦¬ ìƒì„±
  - ì˜µì…˜
    - `--datasource-provider`
    - `--url`

```bash
npx prisma init
```

prisma  
â”œâ”€â”€ .env  
â””â”€â”€ schema.prisma

- **Prisma migrate**

```bash
npx prisma migrate --name { folder_name }
```

- Dev Migrate  
   ê°œë°œí™˜ê²½ì—ëŠ” `migrate dev` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•˜ê³  ì ìš©í•œë‹¤

  ```bash
  npx prisma migrate dev
  ```

  ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìˆ˜ë™ ë³€ê²½ ë˜ëŠ” `db push`ë¥¼ ì·¨ì†Œê°€ ê°€ëŠ¥í•˜ë‹¤

- reset

  - ì˜µì…˜
    `--force` : ê°•ì œë¡œ reset  
    `--skip-generate` : prisma generate ê³¼ì • skip  
    `--skip-seed` : seed file ì‹¤í–‰ skip

  ```bash
  npx prisma migrate reset
  ```

  - soft re-config
  - ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‚­ì œë  ê²½ìš° ê°™ì€ ì´ë¦„ìœ¼ë¡œ ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±
  - ëª¨ë“  migration ì ìš©
  - seed file ì‹¤í–‰

    - seed : sample dataë¥¼ ë„£ëŠ”ë‹¤

      ```bash
      npx prisma db seed --preview-feature
      ```

- Custom Migration

  ```bash
  npx prima migrate dev --create-only
  ```

  Migrationì„ ì ìš©í•˜ê¸° ì „ì— ìˆ˜ì •ì´ í•„ìš”í•œ ìƒí™©  
  DBì—ëŠ” ì ìš©ì´ ë˜ì§„ ì•ŠëŠ”ë‹¤

- Product ë° Test

  ```bash
  npx prisma migrate deploy
  ```

- **DB push**
  - ì˜µì…˜
    - `--preivew-feature`
    - `--skip-generate`
    - `--force`
    - `--schema`

schema.prismaì˜ ë‚´ìš©ì„ migrationì—†ì´ ì¦‰ì‹œ db schemaì— ì ìš©í•œë‹¤  
ë³€ê²½ì‚¬í•­ì´ DBì— ì ìš©ì´ ë˜ë©´ generatorê°€ ì‹¤í–‰ì´ ëœë‹¤  
db push ë°ì´í„° ì†ì‹¤ì´ ì¼ì–´ë‚  ìˆ˜ ìˆìœ¼ë¯€ë¡œ production í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤

- **DB pull**
  - ì˜µì…˜
    - `--force`
    - `--print`
    - `--schema`

db schemaë¥¼ schema.prismaì— overwriting í•œë‹¤  
ê¸°ì¡´ì— ì €ì¥ëœ schema.prismaì˜ schemaëŠ” ì‚¬ë¼ì§„ë‹¤

### Prisma Schema

- **Data sources**: Prismaê°€ ì—°ê²°í•´ì•¼í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì† ì‹œ í•„ìš”í•œ ì •ë³´ë¥¼ ì •ì˜
- **Generators**: Prisma Clientë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ì–´ì•¼ í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ë¥¼ ì •ì˜
- **Data model** definition: ë°ì´í„° ëª¨ë¸(í…Œì´ë¸”)ì„ ì •ì˜

- Data sources

```typescript
generator client {
  provider = "prisma-client-js"
// ì–¸ì–´ë³„ clientë¥¼ ì§€ì •í•œ ë¶€ë¶„(JavaScript)
}

prisma-client-js : JavaScript Client

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}
// DB ê³µê¸‰ìì™€
// DB urlì„ ì§€ì •í•œë‹¤
```

- **Prisma generate**
  - ì˜µì…˜
    `--schema` : schema.prisma ê²½ë¡œ  
    `--watch` : ë³€ê²½ì‚¬í•­ì„ ì§€ì†ì ìœ¼ë¡œ í™•ì¸

```bash
npx prisma generate
```

1. node_modulesë¥¼ ì°¾ëŠ”ë‹¤
2. node_modulesì— @prisam/clinetê°€ ì—†ìœ¼ë©´ ìƒì„±
3. í˜„ì¬ ë””ë ‰í† ë¦¬ë¥¼ ê²€ì‚¬í•˜ì—¬ schema.prismaë¥¼ ì°¾ì•„ @prisma/clinet ìƒì„± ë° ìˆ˜ì •

- **Prisma introspect**

```bash
npx prisma introspect
```

DB schemaë¥¼ ê°€ì ¸ì™€ schema.prismaë¥¼ overwritingí•œë‹¤

- ì˜µì…˜
  `--force` : ê°•ì œë¡œ overwrite  
  `--schema` : schema.prisma ê²½ë¡œ  
  `--print` : ìƒì„±ëœ schema.prismaë¥¼ cliì— ì¶œë ¥

- **Prisma resolve**
  - ì˜µì…˜
    `--applied` : íŠ¹ì • migration ì ìš©í•œ history ê¸°ë¡  
    `--rolled-back` : íŠ¹ì • migrationì„ ë¡¤ë°±í•œ histroy ê¸°ë¡

migrateë¥¼ í•˜ë©´ migration íŒŒì¼ê³¼ DBì˜ ì •ë³´ê°€ ë™ê¸°í™”ê°€ ì§„í–‰ì´ ëœë‹¤  
ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™©ìœ¼ë¡œ migration íŒŒì¼ê³¼ DBê°€ ë™ê¸°í™”ê°€ ë˜ì–´ìˆì§€ ì•Šì•„ ìˆ˜ì •ë˜ì–´ ìˆëŠ” íŒŒì¼ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  DBì— ì ìš©ì´ ì•ˆë˜ëŠ”  
history ë¬¸ì œê°€ ë°œìƒí•  ì‹œ resolve ëª…ë ¹ì„ í†µí•´ í•·ì…©í•  ìˆ˜ ìˆë‹¤

```bash
npx prisma migrate resolve
```

- **Prisma Status**

migration ìƒíƒœ ì¡°íšŒ

```bash
npx prisma migrate statusd --preview-feature
```
