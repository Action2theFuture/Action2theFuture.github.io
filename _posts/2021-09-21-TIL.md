---
layout: post
title: "DockerSwarm"
date: 2021-09-21
categories: TIL Docker-machine DockerSwarm
---

# Docker-machine

로컬컴퓨터가 배포된 도커와 버전이 다를경우 dockermachine을 통한 VM으로 개발을 할 수가 있다  
로컬컴퓨터가 의존적이지 않는 상황으로 만들어줌으로써 편리함을 제공해준다

지금은 Docker-machine을 지원하지 않는다 하지만 현재까지 개발과정에서는 많이 사용되고 있다
[Deprecated Engine Features | Docker Documentation](https://docs.docker.com/machine/)
[Deprecate Docker Machine · Issue](https://github.com/docker/roadmap/issues/245)

# DockerSwarm

## compose와 swarm 연결흐름

![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/swarmflow.jpg)

최소한 2개의 노드가 필요하다

하나의 노드는 manage(leader)노드이고 다른 하나는 worker노드로 설정하여  
EC2에 만들어 놓았다

각 노드 연결은 `2377 port`로 연결이 된다

# Docker swarm 명령어

1. `docker swarm init`
   ![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/dockerswarminit1.png)  
   leader 노드에서 docker swarm을 초기화 및 실행을 시킨다

   - leader node 확인
     ![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/dockerswarminit.png)

2. `docker swarm init`을 실행하면 `docker swarm join --token ~~`이 출력이 된다 이것을 복사하여 worker 노드에 붙여넣고 실행을 한다
   ![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/dockerswarmjoin1.png)
   - worker node 확인
     ![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/dockerswarmjoin.png)
3. `docker stack deploy -c docker-compose.yml web`으로 docker swarm을 실행한다

```
Creating service web_{docker_service}
Creating service web_{docker_service2}
```

## 기타 명령어

- 모든 Docker service의 상황 출력
  `docker service ls`
- Docker service의 상황 출력
  `docker service ps {service_name}`
- Docker service의 에러사항을 포맷팅으로 출력  
   `docker service ps --format "{{.Error}}" {service_name}`
- Docker service 검사
  `docker service inspect {service_name}`
- Docker service 로그 확인
  `docker service logs {service_name}`
- Docker service 삭제
  `docker service rm {service_name}`
- Docker service 업데이트
  `docker service update`
