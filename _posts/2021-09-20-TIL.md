---
layout: post
title: "Docker, Docker-Compose ê¸°ì´ˆğŸ’¬"
date: 2021-09-20
categories: TIL Docker Docker-Compose
---

[Docker ê³µì‹ë¬¸ì„œ](https://docs.docker.com/compose/gettingstarted/)

**Docker Compose**
![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/dockercompose.png)

ê·¸ë¦¼ì„ ë³´ë©´ ë¬¸ì–´ê°€ ê° ì»¨í…Œì´ë„ˆë¥¼ ì¡ê³  ë†€ê³ ìˆë‹¤  
ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆë“¯ì´ ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆë¥¼ ë¬¶ì–´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤  
docker-compose.ymlë¥¼ ì‚¬ìš©í•˜ì—¬ DBì„œë²„, ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„, ì›¹ì„œë²„ ë“±ì„ ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°í•˜ì—¬ ë¶„ë¦¬ë˜ì–´ ìˆëŠ” ì„œë²„ë“¤ì„ í•˜ë‚˜ë¡œ ê´€ë¦¬í•œë‹¤ëŠ” ê²ƒì´ë‹¤

- ë²„ì „ ê´€ë¦¬ì— ìš©ì´
- í˜‘ì—½ íš¨ìœ¨ ìƒìŠ¹
- ìœ ì§€ë³´ìˆ˜ê°€ í¸ë¦¬

dockerfileëŠ” dockerë¥¼ ì»¨í…Œì´ë„ˆë¥¼ ì…‹íŒ…í™˜ê²½ì„ ë§Œë“¤ì–´ ì‹¤í–‰í•´ì£¼ê³  docker-compose.ymlíŒŒì¼ë¡œ ê° ì»¨í…Œì´ë„ˆì˜ ìƒì„±ê³¼ ì„¤ì •ë“¤ì„ í•´ì¤€ë‹¤

**dockerfile**

```dockerfile
#./Dockerfile
FROM python:3.9
#ê¸°ë°˜ì´ ë  ì´ë¯¸ì§€

# ì‘ì—…ë””ë ‰í† ë¦¬(default)ì„¤ì •
WORKDIR /usr/src/app

## Install packages
#í˜„ì¬ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì •ë³´ë¥¼ ë„ì»¤ ì´ë¯¸ì§€ì— ë³µì‚¬
COPY requirements.txt ./
#ì„¤ì¹˜ì •ë³´ë¥¼ ì½ì–´ ë“¤ì—¬ì„œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜
RUN pip install -r requirements.txt

## Copy all src files
#í˜„ì¬ê²½ë¡œì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ì†ŒìŠ¤íŒŒì¼ì„ ì´ë¯¸ì§€ì— ë³µì‚¬
COPY . .


## Run the application on the port 8080
#8000ë²ˆ í¬íŠ¸ë¥¼ ì™¸ë¶€ì— ê°œë°©í•˜ë„ë¡ ì„¤ì •
EXPOSE 8000


#CMD ["python", "./setup.py", "runserver", "--host=0.0.0.0", "-p 8080"]
#gunicornì„ ì‚¬ìš©í•´ì„œ ì„œë²„ë¥¼ ì‹¤í–‰
CMD ["gunicorn", "--bind", "0.0.0.0:8000", "drf_test.wsgi:application"]
```

**docker ëª…ë ¹ì–´**

- docker ps : ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆë¥¼ ë³´ì—¬ì£¼ëŠ” ì»¤ë§¨ë“œ
- docker ps -a : ì‹¤í–‰ì´ ì¢…ë£Œëœ ê²ƒì„ í¬í•¨í•´ì„œ ëª¨ë“  ì»¨í…Œì´ë„ˆë¥¼ ë³´ëŠ” ì»¤ë§¨ë“œ ë° ì˜µì…˜
- docker images : ìƒì„±ëœ í˜¹ì€ ë‹¤ìš´ë¡œë“œ ëœ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ì»¤ë§¨ë“œ
- docker images -a : ëª¨ë“  ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ì»¤ë§¨ë“œ ë° ì˜µì…˜
- docker rm $(docker ps -a -q) : ì´ë¯¸ì§€ ì‚­ì œ
- docker rmi $(docker images -q) : ëª¨ë“  ì´ë¯¸ì§€ ì‚­ì œ

- docker build -t 'ë„ì»¤í—ˆë¸Œì— ê°€ì…í•œ ê³„ì •ëª…'/'ì´ë¯¸ì§€ëª…(í”„ë¡œì íŠ¸ëª… ê¶Œì¥)':'ë²„ì „' . : Docker build
- docker run --name 'ì»¨í…Œì´ë„ˆ ëª…' -d'ë°ëª¬ìœ¼ë¡œ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì˜µì…˜' -p 'í˜¸ìŠ¤íŠ¸ í¬íŠ¸':'ì»¨í…Œì´ë„ˆ í¬íŠ¸' 'ì´ë¯¸ì§€ëª…' : Docker run

**docker-compose.yml**

```dockerfile
version: "3"
# docker composeì˜ ë²„ì „

services:
  server:
  # ì»¨í…Œì´ë„ˆ ì´ë¦„
    build: ./
    # docekrfile ê²½ë¡œ
    volumes:
      - ./:/usr/src/app
    # ì»¨í…Œì–´ë„ˆê°€ ì‹¤í–‰ë  ê²½ë¡œ
    command:
    # dockerê°€ ì‹¤í–‰í•˜ê¸°ì „ì— ì‹¤í–‰í•œ ì»¤ë§¨ë“œ
      - bash
      - -c
      - |
        python manage.py collectstatic --no-input
        python manage.py migrate

    depends_on:
      - sqlite3
    # ì»¨í…Œì´ë„ˆ ì—°ê²°(ì—¬ê¸°ì„œëŠ” DBì™€ ì—°ê²°)
    ports:
      - 8000:8000

  sqlite3:
    image: nouchka/sqlite3:latest
    #ì‚¬ìš©í•  ì´ë¯¸ì§€
    stdin_open: true
    tty: true
    volumes:
      - ./db.sqlite3
```

- docker-compose ì‹¤í–‰
  - `docker-compose up -d` : ë°ëª¬í™˜ê²½ìœ¼ë¡œ ì‹¤í–‰
  - `docker-compose up` : consoleì°½ì— ì—ëŸ¬ë©”ì‹œë„ ë³¼ ìˆ˜ ìˆë‹¤
- docker-compose ë„ê¸°
  - `docker-compose down`
- docker-compose ë¹Œë“œ
  - `docker-compose build || docker-compose up -d --force-recreate --build`

**docker workflow**
![](https://raw.githubusercontent.com/Action2theFuture/Action2theFuture.github.io/main/_posts/Images/dockerwork.png)

[Docker ëª…ë ¹ì–´](https://watch-n-learn.tistory.com/34)

**Docker PID host access**

- `docker run -ltd --pid=host`
  í”¼ë“œë¥¼ í˜¸ìŠ¤íŠ¸ë¡œ í• ë‹¹ì‹œ ì‹œìŠ¤í…œ ì ‘ê·¼ ë¶€ë¶„ì ìœ¼ë¡œ ê°€ëŠ¥
  ë‚´ë¶€ì ìœ¼ë¡œëŠ” pid 1ë¡œ í• ë‹¹ì´ ë˜ì–´ìˆì§€ë§Œ ì‹¤ì œë¡œëŠ” pid1ì´ ì•„ë‹Œ ë‹¤ë¥¸ pidë¡œ ì§€ì •

- `docker run -ltd`
  í˜¸ìŠ¤íŠ¸ë¡œ í• ë‹¹ì´ ì•ˆë˜ë©´ ì‹œìŠ¤í…œ ì ‘ê·¼ ë¶ˆê°€ëŠ¥
